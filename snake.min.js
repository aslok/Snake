function Snake(i){main={create_dot:function(b){$("<div/>").addClass("snake_body").css("width",main.settings.size+"px").css("height",main.settings.size+"px").css("top",b.y+"px").css("left",b.x+"px").appendTo(main.settings.object);b.el=$(".snake_body:last");return b},change_dot:function(b){$(b.el).css("left",b.x+"px").css("top",b.y+"px")},create_dots:function(){$(".snake_body").remove();for(var b,a,c=[];c.length<main.settings.start_count;)c.length?(b=c[c.length-1].x,a=c[c.length-1].y,main.settings.start_vert?
a+="down"==main.settings.start_direction?-main.settings.size:main.settings.size:b+="right"==main.settings.start_direction?-main.settings.size:main.settings.size):(a=parseInt(parseInt(main.get_used_height()/2/main.settings.size)*main.settings.size),b=parseInt(parseInt(main.get_used_width()/2/main.settings.size)*main.settings.size)),c[c.length]=main.create_dot({x:b,y:a});return c},move_to:function(){for(var b=!1,a,c,d,f={},e=0;e<main.dots.length;e++){a=main.dots[e];if(e)c=a.x,d=a.y,a.x=f.x,a.y=f.y,
f.x=c,f.y=d;else{f.x=a.x;f.y=a.y;switch(main.current_direction){case "down":a.y+=main.settings.size;break;case "up":a.y-=main.settings.size;break;case "right":a.x+=main.settings.size;break;case "left":a.x-=main.settings.size}for(c=1;c<main.dots.length;c++)if(d=main.dots[c],d.x==a.x&&d.y==a.y)return main.on_snake=!0,!1;0>a.y&&(a.y=main.get_used_height());a.y>main.get_used_height()&&(a.y=0);0>a.x&&(a.x=main.get_used_width());a.x>main.get_used_width()&&(a.x=0);a.x==main.apple.x&&a.y==main.apple.y&&(main.remove_apple(),
b=!0)}main.change_dot(a)}b&&(main.dots[main.dots.length]=main.create_dot({x:f.x,y:f.y}));return!0},check_time:function(){main.on_snake&&(window.alert("\u041a\u043e\u043d\u0435\u0446 \u0438\u0433\u0440\u044b. \u0412\u044b \u0441\u044a\u0435\u043b\u0438 "+(main.dots.length-main.settings.start_count)+" \u044f\u0431\u043b\u043e\u043a"),main.set_defaults());var b=(new Date).getTime();main.last_time+main.settings.step_time*(1-1/(main.get_used_width()/main.settings.size*(main.get_used_height()/main.settings.size)/
2/main.dots.length))<b&&(main.last_time=b,main.old_direction=main.current_direction,main.move_to());!main.apple&&main.last_apple_time+10*main.settings.step_time<b&&(main.apple=main.create_apple());main.apple&&(main.last_apple_time=b);window.setTimeout(main.check_time,main.settings.iter_time)},create_apple:function(){for(var b,a,c=!1,d={x:!1,y:!1};c||!1===d.x||!1===d.y;){d.x=parseInt(main.get_random_int(0,main.get_used_width())/main.settings.size)*main.settings.size;d.y=parseInt(main.get_random_int(0,
main.get_used_height())/main.settings.size)*main.settings.size;c=!1;for(b=0;b<main.dots.length;b++)if(a=main.dots[b],a.x==d.x&&a.y==d.y){c=!0;break}}$("<div/>").addClass("snake_apple").css("width",main.settings.size+"px").css("height",main.settings.size+"px").css("top",d.y+"px").css("left",d.x+"px").prependTo(main.settings.object);d.el=$(".snake_apple");return d},remove_apple:function(){main.apple=!1;$(".snake_apple").remove()},get_used_height:function(){return parseInt(($(main.settings.object).height()-
main.settings.size)/main.settings.size)*main.settings.size},get_used_width:function(){return parseInt(($(main.settings.object).width()-main.settings.size)/main.settings.size)*main.settings.size},get_random_int:function(b,a){return Math.floor(Math.random()*(a-b+1))+b},set_defaults:function(){main.current_direction=main.settings.start_direction;main.old_direction=main.current_direction;main.last_time=(new Date).getTime()+main.settings.step_time;main.last_apple_time=0;main.on_snake=!1;main.dots=main.create_dots();
main.remove_apple()},settings:{}};var e,g,j={object:"body",size:10,start_count:5,start_vert:!0,iter_time:10,step_time:200};for(e in i)g=i[e],"function"!=typeof g&&(main.settings[e]=g);for(e in j)g=j[e],"function"!=typeof g&&"undefined"==typeof main.settings[e]&&(main.settings[e]=g);main.settings.start_direction=main.settings.start_vert?"down":"right";main.set_defaults();var h=!0;$(document).keydown(function(b){if(h){switch(b.which){case 40:"up"!=main.old_direction&&"down"!=main.old_direction&&(main.current_direction=
"down");break;case 38:"up"!=main.old_direction&&"down"!=main.old_direction&&(main.current_direction="up");break;case 37:"left"!=main.old_direction&&"right"!=main.old_direction&&(main.current_direction="left");break;case 39:"left"!=main.old_direction&&"right"!=main.old_direction&&(main.current_direction="right")}h=!1}}).keyup(function(){h=!0});main.check_time()};